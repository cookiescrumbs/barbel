{"version":3,"sources":["../../src/suggested-search/index.jsx"],"names":["KEY_ENTER","KEY_ESCAPE","KEY_UP","KEY_DOWN","STYLES","form","position","input","padding","button","left","top","textAlign","border","backgroundColor","searchIcon","searchResults","marginTop","SuggestedSearch","props","state","searchValue","search","activeIndex","keyDownHandlers","clearSearchInput","event","preventDefault","selectNextResult","selectPreviousResult","item","toLowerCase","name","indexOf","items","filter","itemMatchesSearch","results","result","itemStartsWithSearchTerm","matchingResults","resultsStartingWithSearchTerm","list","sort","itemA","itemB","localeCompare","length","resultsMatchingSearch","remainingResults","allResults","alphabeticallyOrder","concat","orderedResults","target","setState","value","handler","keyCode","handleKeyDown","index","errorMessageTemplate","errorMessage","replace","renderedResults","map","renderResultLink","activeDescendant","searchResultID","url","isActive","className","shouldShowError","renderResultsError","renderResultsList","renderClearButton","renderSearchButton","label","placeholder","handleChange","handleInputKeyDown","renderIcon","renderResults","document","getElementById","getAttribute","focus","Component","displayName","propTypes","PropTypes","string","array","isRequired"],"mappings":";;;;;;;;AAAA;;;;;;;;;;;;;;AAEA,IAAMA,YAAY,EAAlB;AACA,IAAMC,aAAa,EAAnB;AACA,IAAMC,SAAS,EAAf;AACA,IAAMC,WAAW,EAAjB;;AAEA,IAAMC,SAAS;AACXC,UAAM;AACFC,kBAAU;AADR,KADK;AAIXC,WAAO;AACHC,iBAAS;AADN,KAJI;AAOXC,YAAQ;AACJH,kBAAU,UADN;AAEJI,cAAM,KAFF;AAGJC,aAAK,KAHD;AAIJC,mBAAW,QAJP;AAKJC,gBAAQ,MALJ;AAMJC,yBAAiB;AANb,KAPG;AAeXC,gBAAY;AACRT,kBAAU,UADF;AAERI,cAAM,MAFE;AAGRC,aAAK,MAHG;AAIRC,mBAAW,QAJH;AAKRC,gBAAQ;AALA,KAfD;AAsBXG,mBAAe;AACXC,mBAAW;AADA;AAtBJ,CAAf;;IA4BqBC,e;;;AAEjB,6BAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AAAA,sIACTA,KADS;;AAEf,cAAKC,KAAL,GAAa;AACTC,yBAAaF,MAAMG,MAAN,IAAgB,EADpB;AAETC,yBAAa,CAAC;AAFL,SAAb;;AAKA,cAAKC,eAAL,uEACKvB,UADL,EACkB,YAAM;AAChB,kBAAKwB,gBAAL;AACH,SAHL,0CAIKtB,QAJL,EAIgB,UAACuB,KAAD,EAAW;AACnBA,kBAAMC,cAAN;AACA,kBAAKC,gBAAL;AACH,SAPL,0CAQK1B,MARL,EAQc,UAACwB,KAAD,EAAW;AACjBA,kBAAMC,cAAN;AACA,kBAAKE,oBAAL;AACH,SAXL;AAPe;AAoBlB;;;;0CAEiBC,I,EAAM;AACpB,gBAAMT,cAAc,KAAKD,KAAL,CAAWC,WAAX,CAAuBU,WAAvB,EAApB;;AAEA,mBAAOV,eAAeS,KAAKE,IAAL,CAAUD,WAAV,GAAwBE,OAAxB,CAAgCZ,WAAhC,IAA+C,CAAC,CAAtE;AACH;;;gDAEuB;AAAA;;AACpB,mBAAO,KAAKF,KAAL,CAAWe,KAAX,CAAiBC,MAAjB,CAAwB,UAACL,IAAD;AAAA,uBAAU,OAAKM,iBAAL,CAAuBN,IAAvB,CAAV;AAAA,aAAxB,CAAP;AACH;;;iDAEwBA,I,EAAM;AAC3B,mBAAOA,KAAKE,IAAL,CAAUD,WAAV,GAAwBE,OAAxB,CAAgC,KAAKb,KAAL,CAAWC,WAAX,CAAuBU,WAAvB,EAAhC,MAA0E,CAAjF;AACH;;;sDAE6BM,O,EAAS;AAAA;;AACnC,mBAAOA,QAAQF,MAAR,CAAe,UAACG,MAAD;AAAA,uBAAY,OAAKC,wBAAL,CAA8BD,MAA9B,CAAZ;AAAA,aAAf,CAAP;AACH;;;yCAEgBE,e,EAAiBC,6B,EAA+B;AAC7D,mBAAOD,gBAAgBL,MAAhB,CAAuB,UAACL,IAAD;AAAA,uBAAUW,8BAA8BR,OAA9B,CAAsCH,IAAtC,MAAgD,CAAC,CAA3D;AAAA,aAAvB,CAAP;AACH;;;4CAEmBY,I,EAAM;AACtB,mBAAOA,KAAKC,IAAL,CAAU,UAACC,KAAD,EAAQC,KAAR;AAAA,uBAAkBD,MAAMZ,IAAN,CAAWc,aAAX,CAAyBD,MAAMb,IAA/B,CAAlB;AAAA,aAAV,CAAP;AACH;;;yCAEgB;AACb,gBAAI,KAAKZ,KAAL,CAAWC,WAAX,CAAuB0B,MAAvB,GAAgC,CAApC,EAAuC;AACnC,uBAAO,EAAP;AACH;AACD,gBAAMC,wBAAwB,KAAKA,qBAAL,EAA9B;;AAEA,gBAAMP,gCAAgC,KAAKA,6BAAL,CAAmCO,qBAAnC,CAAtC;;AAEA,gBAAMC,mBAAmB,KAAKA,gBAAL,CAAsBD,qBAAtB,EAA6CP,6BAA7C,CAAzB;;AAEA,gBAAMS,aAAa,KAAKC,mBAAL,CAAyBV,6BAAzB,EAAwDW,MAAxD,CAA+D,KAAKD,mBAAL,CAAyBF,gBAAzB,CAA/D,CAAnB;;AAEA,mBAAOC,UAAP;AACH;;;wCAEeG,c,EAAgB;AAC5B,mBAAOA,eAAeN,MAAf,KAA0B,CAA1B,IAA+B,KAAK3B,KAAL,CAAWC,WAAX,CAAuB0B,MAAvB,IAAiC,CAAvE;AACH;;;qCAEYrB,K,EAAO;AAChB,gBAAIA,MAAM4B,MAAV,EAAkB;AACd,qBAAKC,QAAL,CAAc;AACVlC,iCAAaK,MAAM4B,MAAN,CAAaE,KADhB;AAEVjC,iCAAa,CAAC;AAFJ,iBAAd;AAIH;AACJ;;;2CAEkB;AACf,gBAAM8B,iBAAiB,KAAKA,cAAL,EAAvB;;AAEA,gBAAI,KAAKjC,KAAL,CAAWG,WAAX,GAAyB8B,eAAeN,MAAf,GAAwB,CAArD,EAAwD;AACpD,qBAAKQ,QAAL,CAAc,EAAEhC,aAAa,KAAKH,KAAL,CAAWG,WAAX,GAAyB,CAAxC,EAAd;AACH;AACJ;;;+CAEsB;AACnB,gBAAI,KAAKH,KAAL,CAAWG,WAAX,GAAyB,CAAC,CAA9B,EAAiC;AAC7B,qBAAKgC,QAAL,CAAc,EAAEhC,aAAa,KAAKH,KAAL,CAAWG,WAAX,GAAyB,CAAxC,EAAd;AACH;AACJ;;;sCAEaG,K,EAAO;AACjB,gBAAM+B,UAAU,KAAKjC,eAAL,CAAqBE,MAAMgC,OAA3B,CAAhB;;AAEA,gBAAID,OAAJ,EAAa;AACTA,wBAAQ/B,KAAR;AACH;AACJ;;;2CAEkBA,K,EAAO;AACtB,gBAAIA,MAAMgC,OAAN,KAAkB1D,SAAtB,EAAiC;AAC7B0B,sBAAMC,cAAN;AACH;;AAED,iBAAKgC,aAAL,CAAmBjC,KAAnB;AACH;;;2CAEkB;AACf,iBAAK6B,QAAL,CAAc,EAAElC,aAAa,EAAf,EAAd;AACH;;;uCAEcuC,K,EAAO;AAClB,sCAAwBA,KAAxB;AACH;;;6CAEoB;AACjB,gBAAMC,uBAAuB,KAAK1C,KAAL,CAAW2C,YAAX,IAA2B,mDAAxD;;AAEA,gBAAMA,eAAeD,qBAAqBE,OAArB,CAA6B,aAA7B,EAA4C,KAAK3C,KAAL,CAAWC,WAAvD,CAArB;;AAEA,mBAAO;AAAA;AAAA,kBAAK,WAAU,oBAAf;AAAqCyC;AAArC,aAAP;AACH;;;0CAEiBT,c,EAAgB;AAAA;;AAC9B,gBAAMW,kBAAkBX,eAAeY,GAAf,CAAmB,UAAC3B,MAAD,EAASsB,KAAT;AAAA,uBAAmB,OAAKM,gBAAL,CAAsB5B,MAAtB,EAA8BsB,KAA9B,CAAnB;AAAA,aAAnB,CAAxB;;AAEA,gBAAIO,mBAAmB,IAAvB;;AAEA,gBAAI,KAAK/C,KAAL,CAAWG,WAAX,GAAyB,CAAC,CAA9B,EAAiC;AAC7B4C,mCAAmB,KAAKC,cAAL,CAAoB,KAAKhD,KAAL,CAAWG,WAA/B,CAAnB;AACH;;AAED,mBACI;AAAA;AAAA;AACI,wBAAG,qBADP;AAEI,6CAAuB4C,gBAF3B;AAGI,+BAAU,YAHd;AAII,0BAAK,SAJT;AAKGH;AALH,aADJ;AASH;;;yCAEgBlC,I,EAAM8B,K,EAAO;AAAA;;AAC1B,gBAAI9B,KAAKuC,GAAT,EAAc;AACV,oBAAMC,WAAWV,UAAU,KAAKxC,KAAL,CAAWG,WAAtC;;AAEA,oBAAMgD,kCAA+BD,WAAW,SAAX,GAAuB,EAAtD,CAAN;;AAEA,uBAAO;AAAA;AAAA;AACH,4BAAI,KAAKF,cAAL,CAAoBR,KAApB,CADD;AAEH,mCAAWW,SAFR;AAGH,8BAAK,QAHF;AAIH,8BAAMzC,KAAKuC,GAJR;AAKH,mCAAW,mBAAC3C,KAAD;AAAA,mCAAW,OAAKiC,aAAL,CAAmBjC,KAAnB,CAAX;AAAA,yBALR;AAMH,6BAAKkC;AANF;AAOL9B,yBAAKE;AAPA,iBAAP;AAQH;;AAED,mBAAOF,KAAKE,IAAZ;AACH;;;wCAEe;AACZ,gBAAMqB,iBAAiB,KAAKA,cAAL,EAAvB;;AAEA,mBACI;AAAA;AAAA,kBAAK,MAAK,QAAV,EAAmB,IAAG,gBAAtB,EAAuC,aAAU,QAAjD,EAA0D,OAAOjD,OAAOY,aAAxE;AACK,qBAAKwD,eAAL,CAAqBnB,cAArB,IAAuC,KAAKoB,kBAAL,EAAvC,GAAmE,KAAKC,iBAAL,CAAuBrB,cAAvB;AADxE,aADJ;AAKH;;;6CAEoB;AACjB,mBACI;AAAA;AAAA,kBAAG,OAAOjD,OAAOW,UAAjB,EAA6B,WAAU,wCAAvC;AACI;AAAA;AAAA,sBAAM,WAAU,QAAhB;AAAA;AAAA;AADJ,aADJ;AAKH;;;4CAEmB;AAAA;;AAChB,mBACI;AAAA;AAAA;AACI,2BAAOX,OAAOK,MADlB;AAEI,yBAAI,cAFR;AAGI,0BAAK,QAHT;AAII,6BAAS;AAAA,+BAAM,OAAKgB,gBAAL,EAAN;AAAA,qBAJb;AAKI,+BAAU,uBALd;AAMI;AAAA;AAAA,sBAAG,WAAU,4CAAb;AACI;AAAA;AAAA,0BAAM,WAAU,QAAhB;AAAA;AAAA;AADJ;AANJ,aADJ;AAYH;;;qCAEY;AACT,mBAAO,KAAKL,KAAL,CAAWC,WAAX,CAAuB0B,MAAvB,GAAgC,CAAhC,IAAqC,CAAC,KAAK5B,KAAL,CAAWG,MAAjD,GACD,KAAKqD,iBAAL,EADC,GAED,KAAKC,kBAAL,EAFN;AAGH;;;iCAEQ;AAAA;;AACL,mBACI;AAAA;AAAA,kBAAM,QAAO,EAAb,EAAgB,QAAO,KAAvB,EAA6B,OAAOxE,OAAOC,IAA3C,EAAiD,MAAK,QAAtD;AACI;AAAA;AAAA,sBAAO,SAAQ,QAAf,EAAwB,WAAU,QAAlC,EAA2C,IAAG,cAA9C;AAA8D,yBAAKc,KAAL,CAAW0D;AAAzE,iBADJ;AAEI;AACI,2BAAOzE,OAAOG,KADlB;AAEI,0BAAK,MAFT;AAGI,0BAAK,QAHT;AAII,+BAAU,uBAJd;AAKI,iCAAa,KAAKY,KAAL,CAAW2D,WAL5B;AAMI,8BAAU,kBAACpD,KAAD;AAAA,+BAAW,OAAKqD,YAAL,CAAkBrD,KAAlB,CAAX;AAAA,qBANd;AAOI,+BAAW,mBAACA,KAAD;AAAA,+BAAW,OAAKsD,kBAAL,CAAwBtD,KAAxB,CAAX;AAAA,qBAPf;AAQI,2BAAO,KAAKN,KAAL,CAAWC,WARtB;AASI,oCAAe,KATnB;AAUI,kCAAa,KAVjB;AAWI,iCAAY,KAXhB;AAYI,kCAAW,QAZf;AAaI,qCAAc,MAblB;AAcI,0BAAK,UAdT;AAeI,yCAAkB,MAftB;AAgBI,qCAAc;AAhBlB,kBAFJ;AAqBK,qBAAK4D,UAAL,EArBL;AAsBK,qBAAKC,aAAL;AAtBL,aADJ;AA0BH;;;6CAEoB;;AAEjB,gBAAMxC,OAAOyC,SAASC,cAAT,CAAwB,qBAAxB,CAAb;;AAEA,gBAAI1C,IAAJ,EAAU;AACN,oBAAMyB,mBAAmBgB,SAASC,cAAT,CAAwB1C,KAAK2C,YAAL,CAAkB,uBAAlB,CAAxB,CAAzB;;AAEA,oBAAIlB,gBAAJ,EAAsB;AAClBA,qCAAiBmB,KAAjB;AACH,iBAFD,MAEO;AACH,wBAAM/E,QAAQ4E,SAASC,cAAT,CAAwB,cAAxB,CAAd;;AAEA,wBAAI7E,KAAJ,EAAW;AACPA,8BAAM+E,KAAN;AACH;AACJ;AACJ;AACJ;;;;EAxPwC,gBAAMC,S;;kBAA9BrE,e;;;AA2PrBA,gBAAgBsE,WAAhB,GAA8B,iBAA9B;;AAEAtE,gBAAgBuE,SAAhB,GAA4B;AACxBnE,YAAQ,gBAAMoE,SAAN,CAAgBC,MADA;AAExBzD,WAAO,gBAAMwD,SAAN,CAAgBE,KAAhB,CAAsBC,UAFL;AAGxBhB,WAAO,gBAAMa,SAAN,CAAgBC,MAHC;AAIxBb,iBAAa,gBAAMY,SAAN,CAAgBC,MAJL;AAKxB7B,kBAAc,gBAAM4B,SAAN,CAAgBC;AALN,CAA5B","file":"index.js","sourcesContent":["import React from 'react';\n\nconst KEY_ENTER = 13;\nconst KEY_ESCAPE = 27;\nconst KEY_UP = 38;\nconst KEY_DOWN = 40;\n\nconst STYLES = {\n    form: {\n        position: 'relative'\n    },\n    input: {\n        padding: '0 10px 0 45px'\n    },\n    button: {\n        position: 'absolute',\n        left: '5px',\n        top: '7px',\n        textAlign: 'center',\n        border: 'none',\n        backgroundColor: '#fff'\n    },\n    searchIcon: {\n        position: 'absolute',\n        left: '18px',\n        top: '16px',\n        textAlign: 'center',\n        border: 'none'\n    },\n    searchResults: {\n        marginTop: '5px'\n    }\n};\n\n\nexport default class SuggestedSearch extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            searchValue: props.search || '',\n            activeIndex: -1\n        };\n\n        this.keyDownHandlers = {\n            [KEY_ESCAPE]: () => {\n                this.clearSearchInput();\n            },\n            [KEY_DOWN]: (event) => {\n                event.preventDefault();\n                this.selectNextResult();\n            },\n            [KEY_UP]: (event) => {\n                event.preventDefault();\n                this.selectPreviousResult();\n            }\n        };\n    }\n\n    itemMatchesSearch(item) {\n        const searchValue = this.state.searchValue.toLowerCase();\n\n        return searchValue && item.name.toLowerCase().indexOf(searchValue) > -1;\n    }\n\n    resultsMatchingSearch() {\n        return this.props.items.filter((item) => this.itemMatchesSearch(item));\n    }\n\n    itemStartsWithSearchTerm(item) {\n        return item.name.toLowerCase().indexOf(this.state.searchValue.toLowerCase()) === 0;\n    }\n\n    resultsStartingWithSearchTerm(results) {\n        return results.filter((result) => this.itemStartsWithSearchTerm(result));\n    }\n\n    remainingResults(matchingResults, resultsStartingWithSearchTerm) {\n        return matchingResults.filter((item) => resultsStartingWithSearchTerm.indexOf(item) === -1);\n    }\n\n    alphabeticallyOrder(list) {\n        return list.sort((itemA, itemB) => itemA.name.localeCompare(itemB.name));\n    }\n\n    orderedResults() {\n        if (this.state.searchValue.length < 2) {\n            return [];\n        }\n        const resultsMatchingSearch = this.resultsMatchingSearch();\n\n        const resultsStartingWithSearchTerm = this.resultsStartingWithSearchTerm(resultsMatchingSearch);\n\n        const remainingResults = this.remainingResults(resultsMatchingSearch, resultsStartingWithSearchTerm);\n\n        const allResults = this.alphabeticallyOrder(resultsStartingWithSearchTerm).concat(this.alphabeticallyOrder(remainingResults));\n\n        return allResults;\n    }\n\n    shouldShowError(orderedResults) {\n        return orderedResults.length === 0 && this.state.searchValue.length >= 2;\n    }\n\n    handleChange(event) {\n        if (event.target) {\n            this.setState({\n                searchValue: event.target.value,\n                activeIndex: -1\n            });\n        }\n    }\n\n    selectNextResult() {\n        const orderedResults = this.orderedResults();\n\n        if (this.state.activeIndex < orderedResults.length - 1) {\n            this.setState({ activeIndex: this.state.activeIndex + 1 });\n        }\n    }\n\n    selectPreviousResult() {\n        if (this.state.activeIndex > -1) {\n            this.setState({ activeIndex: this.state.activeIndex - 1 });\n        }\n    }\n\n    handleKeyDown(event) {\n        const handler = this.keyDownHandlers[event.keyCode];\n\n        if (handler) {\n            handler(event);\n        }\n    }\n\n    handleInputKeyDown(event) {\n        if (event.keyCode === KEY_ENTER) {\n            event.preventDefault();\n        }\n\n        this.handleKeyDown(event);\n    }\n\n    clearSearchInput() {\n        this.setState({ searchValue: '' });\n    }\n\n    searchResultID(index) {\n        return `search-result-${index}`;\n    }\n\n    renderResultsError() {\n        const errorMessageTemplate = this.props.errorMessage || 'Sorry, there are no search results for {{search}}';\n\n        const errorMessage = errorMessageTemplate.replace(/{{search}}/g, this.state.searchValue);\n\n        return <div className=\"well well-sm error\">{errorMessage}</div>;\n    }\n\n    renderResultsList(orderedResults) {\n        const renderedResults = orderedResults.map((result, index) => this.renderResultLink(result, index));\n\n        let activeDescendant = null;\n\n        if (this.state.activeIndex > -1) {\n            activeDescendant = this.searchResultID(this.state.activeIndex);\n        }\n\n        return (\n            <div\n                id=\"search-results-list\"\n                aria-activedescendant={activeDescendant}\n                className=\"list-group\"\n                role=\"listbox\">\n              {renderedResults}\n            </div>\n        );\n    }\n\n    renderResultLink(item, index) {\n        if (item.url) {\n            const isActive = index === this.state.activeIndex;\n\n            const className = `list-group-item ${isActive ? ' active' : ''}`;\n\n            return <a\n                id={this.searchResultID(index)}\n                className={className}\n                role=\"option\"\n                href={item.url}\n                onKeyDown={(event) => this.handleKeyDown(event)}\n                key={index}\n            >{item.name}</a>;\n        }\n\n        return item.name;\n    }\n\n    renderResults() {\n        const orderedResults = this.orderedResults();\n\n        return (\n            <div role=\"region\" id=\"search-results\" aria-live=\"polite\" style={STYLES.searchResults}>\n               { this.shouldShowError(orderedResults) ? this.renderResultsError() : this.renderResultsList(orderedResults)}\n            </div>\n        );\n    }\n\n    renderSearchButton() {\n        return (\n            <i style={STYLES.searchIcon} className=\"search-icon glyphicon glyphicon-search\">\n                <span className=\"hidden\">Search</span>\n            </i>\n        );\n    }\n\n    renderClearButton() {\n        return (\n            <button\n                style={STYLES.button}\n                key=\"clear-button\"\n                type=\"button\"\n                onClick={() => this.clearSearchInput()}\n                className=\"btn btn-default clear\">\n                <i className=\"clear-icon glyphicon glyphicon-remove-sign\">\n                    <span className=\"hidden\">Clear input</span>\n                </i>\n            </button>\n        );\n    }\n\n    renderIcon() {\n        return this.state.searchValue.length > 0 && !this.props.search\n            ? this.renderClearButton()\n            : this.renderSearchButton();\n    }\n\n    render() {\n        return (\n            <form action=\"\" method=\"get\" style={STYLES.form} role=\"search\">\n                <label htmlFor=\"search\" className=\"hidden\" id=\"search-input\">{this.props.label}</label>\n                <input\n                    style={STYLES.input}\n                    type=\"text\"\n                    name=\"search\"\n                    className=\"form-control input-lg\"\n                    placeholder={this.props.placeholder}\n                    onChange={(event) => this.handleChange(event)}\n                    onKeyDown={(event) => this.handleInputKeyDown(event)}\n                    value={this.state.searchValue}\n                    autoCapitalize=\"off\"\n                    autoComplete=\"off\"\n                    autoCorrect=\"off\"\n                    aria-label=\"Search\"\n                    aria-haspopup=\"true\"\n                    role=\"combobox\"\n                    aria-autocomplete=\"both\"\n                    aria-controls=\"search-results\"\n                >\n                </input>\n                {this.renderIcon()}\n                {this.renderResults()}\n            </form>\n        );\n    }\n\n    componentDidUpdate() {\n\n        const list = document.getElementById('search-results-list');\n\n        if (list) {\n            const activeDescendant = document.getElementById(list.getAttribute('aria-activedescendant'));\n\n            if (activeDescendant) {\n                activeDescendant.focus();\n            } else {\n                const input = document.getElementById('search-input');\n\n                if (input) {\n                    input.focus();\n                }\n            }\n        }\n    }\n}\n\nSuggestedSearch.displayName = 'SuggestedSearch';\n\nSuggestedSearch.propTypes = {\n    search: React.PropTypes.string,\n    items: React.PropTypes.array.isRequired,\n    label: React.PropTypes.string,\n    placeholder: React.PropTypes.string,\n    errorMessage: React.PropTypes.string\n};\n"]}